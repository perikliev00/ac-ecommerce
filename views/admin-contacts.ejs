<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Запитвания – Админ | NesebarClima</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/admin.css" />
</head>
<body class="admin-page">
  <header class="admin-header">
    <div class="admin-header__inner">
      <a href="/admin" class="admin-header__home">← Продукти</a>
      <h1 class="admin-header__title">Запитвания от контактната форма</h1>
      <nav class="admin-header__nav">
        <a href="/admin/orders" class="admin-header__orders-link">Поръчки</a>
        <a href="/admin/reviews" class="admin-header__orders-link">Отзиви</a>
      </nav>
      <form class="admin-header__logout" action="/admin/logout" method="post">
        <button type="submit" class="admin-header__logout-btn">Изход</button>
      </form>
    </div>
  </header>

  <main class="admin-main">
    <% if (typeof dbOffline !== 'undefined' && dbOffline) { %>
      <div class="admin-alert admin-alert--error">
        Базата данни не е налична. Запитванията не могат да се зареждат в момента.
      </div>
    <% } %>
    <% if (typeof deleted !== 'undefined' && deleted) { %>
      <div class="admin-alert admin-alert--success">Запитването беше изтрито.</div>
    <% } %>

    <section class="admin-list-section">
      <h2>Всички запитвания (<%= requests.length %>)</h2>
      <% if (!requests || requests.length === 0) { %>
        <p class="admin-list__empty">Все още няма изпратени запитвания от формата за контакти.</p>
      <% } else { %>
        <div class="admin-table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Име</th>
                <th>Имейл</th>
                <th>Телефон</th>
                <th>Относно</th>
                <th>Дата</th>
                <th>Статус</th>
                <th>Действия</th>
              </tr>
            </thead>
            <tbody>
              <% requests.forEach(function(r) { %>
                <tr class="<%= r.ready ? 'admin-table__row--ready' : '' %>">
                  <td><strong><%= r.name %></strong></td>
                  <td><a href="mailto:<%= r.email %>"><%= r.email %></a></td>
                  <td><%= r.phone || '—' %></td>
                  <td class="admin-table__text-preview"><%= r.subject || '—' %></td>
                  <td><%= r.createdAt ? new Date(r.createdAt).toLocaleString('bg-BG') : '' %></td>
                  <td>
                    <span class="admin-status-badge admin-status-badge--<%= r.ready ? 'ready' : 'pending' %>">
                      <%= r.ready ? 'Готово' : 'Чака' %>
                    </span>
                  </td>
                  <td>
                    <div class="admin-table__actions">
                      <form class="admin-table__action-form" action="/admin/contacts/<%= r._id.toString() %>/ready" method="post">
                        <button type="submit" class="admin-table__btn admin-table__btn--ready"><%= r.ready ? 'Върни като чакаща' : 'Отбележи като готово' %></button>
                      </form>
                      <form class="admin-table__delete-form admin-table__action-form" action="/admin/contacts/<%= r._id.toString() %>/delete" method="post" onsubmit="return confirm('Изтриване на това запитване?');">
                        <button type="submit" class="admin-table__btn admin-table__btn--delete">Изтрий</button>
                      </form>
                    </div>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      <% } %>
    </section>
  </main>
</body>
</html>

